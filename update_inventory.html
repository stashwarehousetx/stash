<!DOCTYPE html>
<html>
  <head>
    <title>Edit Inventory</title>
  </head>
  <body>
    <h2>Edit Inventory Item</h2>
    <form id="inventoryForm">
      <label for="id">Item ID:</label><br>
      <input type="text" name="id" id="idField" readonly><br><br>

      <label for="name">Item Name:</label><br>
      <input type="text" name="name" id="nameField" required><br><br>

      <label for="quantity">Quantity:</label><br>
      <input type="number" name="quantity" id="quantityField" required><br><br>

      <label for="adjustType">Adjust Type:</label><br>
      <select id="adjustType">
        <option value="subtract">Subtract</option>
        <option value="add">Add</option>
      </select><br><br>

      <label for="adjustAmount">Adjustment Amount:</label><br>
      <input type="number" id="adjustAmount" placeholder="Enter amount"><br><br>

      <button type="submit">Update Item</button>
    </form>

    <p id="responseMessage"></p>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const quantityField = document.getElementById("quantityField");
        const adjustType = document.getElementById("adjustType");
        const adjustAmount = document.getElementById("adjustAmount");

        // Populate itemID and load data
        const urlParams = new URLSearchParams(window.location.search);
        const itemID = urlParams.get('itemID');
        if (itemID) {
          document.getElementById('idField').value = itemID;
          fetchInventoryData(itemID);
        }

        function fetchInventoryData(itemID) {
          const scriptURL = "https://script.google.com/macros/s/AKfycbyxHo8K0W0B8cj2_WCJ_EhjKxNNwFj-gE90Xo2-ZT55V30mfJeawwE9-Kq1n157gScU/exec";
          fetch(scriptURL)
            .then(response => response.json())
            .then(data => {
              const item = data.find(item => item.id === itemID);
              if (item) {
                document.getElementById('nameField').value = item.name;
                quantityField.value = item.quantity;
              } else {
                document.getElementById('responseMessage').textContent = "Item not found.";
              }
            })
            .catch(error => {
              document.getElementById('responseMessage').textContent = "Error fetching data: " + error;
            });
        }

        // Update quantity based on adjustment
        adjustAmount.addEventListener("input", updateQuantity);
        adjustType.addEventListener("change", updateQuantity);

        function updateQuantity() {
          const original = parseInt(quantityField.value, 10);
          const adjust = parseInt(adjustAmount.value, 10);

          if (!isNaN(original) && !isNaN(adjust)) {
            if (adjustType.value === "add") {
              quantityField.value = original + adjust;
            } else {
              quantityField.value = Math.max(0, original - adjust);
            }
          }
        }

        // Submit form
        document.getElementById("inventoryForm").addEventListener("submit", function(e) {
          e.preventDefault();
          const formData = new FormData(this);

          fetch("https://script.google.com/macros/s/AKfycbyxHo8K0W0B8cj2_WCJ_EhjKxNNwFj-gE90Xo2-ZT55V30mfJeawwE9-Kq1n157gScU/exec", {
            method: "POST",
            body: formData
          })
          .then(response => response.text())
          .then(text => {
            document.getElementById("responseMessage").textContent = text;
          })
          .catch(error => {
            document.getElementById("responseMessage").textContent = "Error: " + error;
          });
        });
      });
    </script>
  </body>
</html>
